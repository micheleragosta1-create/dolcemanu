(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[285],{7368:function(e,a,s){Promise.resolve().then(s.bind(s,1101))},1101:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return CheckoutPage}});var c=s(7437),t=s(9738),i=s.n(t),r=s(3827),n=s(8676),o=s(1005),l=s(7106),d=s(2860),x=s(2601);let p=x.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY?(0,l.J)(x.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY):null;function CheckoutPage(){let{items:e,totalAmount:a}=(0,o.useCart)(),handleStripeCheckout=async()=>{if(!p){alert("Stripe non \xe8 configurato. Aggiungi NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY.");return}try{let a=await fetch("/api/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:e.map(e=>({name:e.nome,unit_amount:Math.round(100*e.prezzo),quantity:e.qty})),success_url:"".concat(window.location.origin,"/?checkout=success"),cancel_url:"".concat(window.location.origin,"/cart")})}),s=await a.json();(null==s?void 0:s.url)?window.location.href=s.url:alert("Errore durante il checkout Stripe")}catch(e){console.error(e),alert("Errore di rete durante il checkout Stripe")}},s=x.env.NEXT_PUBLIC_PAYPAL_CLIENT_ID||"";return(0,c.jsxs)("main",{className:"jsx-c2a4344eb8b9603e",children:[(0,c.jsx)(r.default,{}),(0,c.jsx)("section",{className:"jsx-c2a4344eb8b9603e checkout-section",children:(0,c.jsxs)("div",{className:"jsx-c2a4344eb8b9603e checkout-container",children:[(0,c.jsx)("h1",{className:"jsx-c2a4344eb8b9603e poppins",children:"Checkout"}),0===e.length?(0,c.jsx)("p",{className:"jsx-c2a4344eb8b9603e",children:"Il carrello \xe8 vuoto."}):(0,c.jsxs)("div",{className:"jsx-c2a4344eb8b9603e checkout-grid",children:[(0,c.jsxs)("div",{className:"jsx-c2a4344eb8b9603e summary",children:[(0,c.jsx)("h2",{className:"jsx-c2a4344eb8b9603e poppins",children:"Riepilogo ordine"}),(0,c.jsx)("ul",{className:"jsx-c2a4344eb8b9603e list",children:e.map(e=>(0,c.jsxs)("li",{className:"jsx-c2a4344eb8b9603e row",children:[(0,c.jsxs)("span",{className:"jsx-c2a4344eb8b9603e",children:[e.nome," \xd7 ",e.qty]}),(0,c.jsxs)("strong",{className:"jsx-c2a4344eb8b9603e",children:["€ ",(e.prezzo*e.qty).toFixed(2)]})]},e.id))}),(0,c.jsxs)("div",{className:"jsx-c2a4344eb8b9603e row total",children:[(0,c.jsx)("span",{className:"jsx-c2a4344eb8b9603e",children:"Totale"}),(0,c.jsxs)("strong",{className:"jsx-c2a4344eb8b9603e",children:["€ ",a.toFixed(2)]})]})]}),(0,c.jsxs)("div",{className:"jsx-c2a4344eb8b9603e payments",children:[(0,c.jsx)("h2",{className:"jsx-c2a4344eb8b9603e poppins",children:"Pagamento"}),(0,c.jsx)("button",{onClick:handleStripeCheckout,className:"jsx-c2a4344eb8b9603e btn btn-primary",children:"Paga con Carta (Stripe)"}),(0,c.jsx)("div",{style:{margin:"1rem 0",color:"#666",textAlign:"center"},className:"jsx-c2a4344eb8b9603e",children:"oppure"}),s?(0,c.jsx)(d.Vv,{options:{clientId:s,currency:"EUR"},children:(0,c.jsx)(d.ch,{style:{layout:"vertical"},createOrder:(e,s)=>s.order.create({intent:"CAPTURE",purchase_units:[{amount:{currency_code:"EUR",value:a.toFixed(2)}}]}),onApprove:async(e,a)=>{var s;await (null===(s=a.order)||void 0===s?void 0:s.capture()),alert("Pagamento PayPal completato!"),window.location.href="/?checkout=success"}})}):(0,c.jsx)("div",{className:"jsx-c2a4344eb8b9603e note",children:"Aggiungi NEXT_PUBLIC_PAYPAL_CLIENT_ID per abilitare PayPal"})]})]})]})}),(0,c.jsx)(n.Z,{}),(0,c.jsx)(i(),{id:"c2a4344eb8b9603e",children:".checkout-section{position:relative;z-index:10;padding:7rem 2rem 3rem}.checkout-container{max-width:1e3px;margin:0 auto}.checkout-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}.summary,.payments{background:#fff;border:1px solid rgba(0,0,0,.06);-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;padding:1rem;-webkit-box-shadow:0 10px 30px rgba(0,0,0,.06);-moz-box-shadow:0 10px 30px rgba(0,0,0,.06);box-shadow:0 10px 30px rgba(0,0,0,.06)}.list{list-style:none;padding:0;margin:0;display:grid;gap:.35rem}.row{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.total{border-top:1px solid#eee;padding-top:.5rem;margin-top:.5rem}.note{text-align:center;color:#888;font-size:.9rem}@media(max-width:992px){.checkout-grid{grid-template-columns:1fr}}"})]})}}},function(e){e.O(0,[871,869,777,971,472,744],function(){return e(e.s=7368)}),_N_E=e.O()}]);